{% extends base.html %}
{% block content %}


<header>Slicing Dimension: {{dimension.name}}</header>

<table id="cells_table" class="display table table-striped" style="width: 100%">
    <thead class="thead-dark">
        <tr>

            {% if not dim.attributes.all %}
            <th rowspan="2">
                {{ dim.name }}
            </th>
            {% endif %}
            {% if dim.attributes.all %}
            <th colspan="{{ dim.attributes.all|length }}">
                {{ dim.name }}
            </th>
            {% endif %}

            {% endfor %}

            <th rowspan="2" class="text-center">
                Show Model
            </th>
        </tr>
        <tr>
            {% for dim in dimensions %}
            {% for attr in dim.attributes.all %}
            <th>
                {{ attr.parent }}:{{ attr.name }}
            </th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>

    </tbody>
</table>


{% endblock content %}

{% block custom_javascript %}
<script>

    

    function model(event, row) {
        // event.preventDefault()
        entries = $(row).closest('tr').children('td').slice(0, -1).map(function () { return this.innerText })
        attributes = $('#cells_table thead tr:eq(1)').children().map(function () { return this.innerText })

        dict = {}
        for (var i = 0; i < attributes.length; i++) {
            dict[attributes[i]] = entries[i]

            $(row).append(`<input type="hidden" name="${attributes[i]}" value="${entries[i]}" /> `)
        }
        dict['log'] = {{ log.pk }}
        $(row).append(`<input type="hidden" name="log" value="{{ log.pk }}" /> `)       
        
        jsonDict = JSON.stringify(dict)
        $(row).append(`<input type="hidden" name="values" value='${jsonDict}' /> `)    
        

        // console.log(JSON.stringify(dict))
        // alert("Show model for: " + JSON.stringify(dict))

        // return false
        return true
    };

    $(document).ready(function () {
        var table = $('#cells_table').DataTable({
            "processing": true,
            "deferRender": true,
            "ajax": {
                'url': "{% url 'get-cells' log.id cube.id %}",
                'dataSrc': ""
            },
            "scrollX": true,
            "columnDefs": [
                {
                    "targets": -1,
                    "defaultContent": `<form name='model_form' action="model" method="POST" onsubmit="model(event, this)">
                                            {% csrf_token %}
                                            <input type='submit' class='btn btn-primary' value='Model'>
                                        </form>`,
                    "data": null,
                    "searchable": false,
                    "sortable": false,
                }
            ],
        });

        $("form[name='model_form']").on('submit', function(){
        console.log("test")


        });
    });


    

</script>

{% endblock custom_javascript %}