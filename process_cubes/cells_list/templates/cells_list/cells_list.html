{% extends 'base.html' %}
{% load render_table from django_tables2 %}
{% block content %}


<table id="cells_table" class="display table table-striped" style="width: 100%">
    <thead class="thead-dark">
        <tr>
            {% for dim in dimensions %}

            {% if not dim.attributes.all %}
            <th rowspan="2">
                {{ dim.name }}
            </th>
            {% endif %}
            {% if dim.attributes.all %}
            <th colspan="{{ dim.attributes.all|length }}">
                {{ dim.name }}
            </th>
            {% endif %}

            {% endfor %}

            <th rowspan="2" class="text-center">
                Show Model
            </th>
        </tr>
        <tr>
            {% for dim in dimensions %}
            {% for attr in dim.attributes.all %}
            <th>
                {{ attr.parent }}:{{ attr.name }}
            </th>
            {% endfor %}
            {% endfor %}
        </tr>
    </thead>
    <tbody>

    </tbody>
</table>


{% endblock content %}

{% block custom_javascript %}
<script>

    function model(row) {
        entries = $(row).closest('tr').children('td').slice(0, -1).map(function() {return this.innerText})
        attributes = $('#cells_table thead tr:eq(1)').children().map(function() {return this.innerText})

        dict = {}
        for (var i = 0; i < attributes.length; i++) {
            dict[attributes[i]] = entries[i]
        }
        dict['log'] = '{{ log.pk }}'

        alert("Show model for: " + JSON.stringify(dict))
    };

    $(document).ready(function () {
        var table = $('#cells_table').DataTable({
            "processing": true,
            "deferRender": true,
            "ajax": {
                'url': "{% url 'get-cells' log.id cube.id %}",
                'dataSrc': ""
            },
            "scrollX": true,
            "columnDefs": [
                {
                    "targets": -1,
                    "defaultContent": "<button class='btn btn-primary' onclick='model(this)'>Model</button>",
                    "data": null,
                    "searchable": false,
                    "sortable": false,
                }
            ],
        });
    });

</script>

{% endblock custom_javascript %}